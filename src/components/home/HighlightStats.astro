---
import { Globe, Sparkles } from "lucide-react";
import { AuroraText } from "../ui/aurora-text";

interface Props {
  stats: any[];
  id?: string;
  className?: string;
}

const { stats = [], id = "highlight-stats", className = "" } = Astro.props;
const gradientId = `${id}-icon-gradient`;
---

{/* Define gradient for icons matching AuroraText effect */}
<svg width="0" height="0" class="absolute pointer-events-none">
  <defs>
    <linearGradient id={gradientId} x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#34d399">
        <animate
          attributeName="stop-color"
          values="#34d399; #10b981; #064e3b; #34d399"
          dur="10s"
          repeatCount="indefinite"></animate>
      </stop>
      <stop offset="50%" stop-color="#10b981">
        <animate
          attributeName="stop-color"
          values="#10b981; #064e3b; #34d399; #10b981"
          dur="10s"
          repeatCount="indefinite"></animate>
      </stop>
      <stop offset="100%" stop-color="#064e3b">
        <animate
          attributeName="stop-color"
          values="#064e3b; #34d399; #10b981; #064e3b"
          dur="10s"
          repeatCount="indefinite"></animate>
      </stop>
    </linearGradient>
  </defs>
</svg>

<div
  class={"grid md:grid-cols-2 gap-6 md:gap-4 divide-y md:divide-y-0 divide-white/10 w-[82%] md:w-[60%] " +
    className}
>
  {
    stats.map((highlight, index) => (
      <div
        class="group py-6 md:py-0  md:first:pl-0 md:last:pr-0 md:first:col-span-2 animate-on-scroll opacity-0 translate-y-8 transition-all duration-700 ease-out"
        style={`transition-delay: ${index * 200 + 400}ms`}
      >
        <div class="flex items-center gap-5 md:gap-3">
          {/* Metric or Icon */}
          <div class="shrink-0 w-16">
            {highlight.metric ? (
              <div class="flex flex-col items-center w-16">
                <AuroraText
                  className="text-4xl md:text-5xl font-bold"
                  colors={["#34d399", "#10b981", "#064e3b"]}
                  client:only="react"
                >
                  {highlight.metric}
                </AuroraText>
                {highlight.label && (
                  <span class="text-xs text-gray-500 mt-1 uppercase tracking-wide">
                    {highlight.label}
                  </span>
                )}
              </div>
            ) : (
              <div class="w-16 h-16 rounded-lg flex items-center justify-center ">
                {highlight.icon === "globe" && (
                  <Globe className="w-12 h-12" stroke={`url(#${gradientId})`} />
                )}
                {highlight.icon === "sparkles" && (
                  <Sparkles
                    className="w-12 h-12"
                    stroke={`url(#${gradientId})`}
                  />
                )}
              </div>
            )}
          </div>

          {/* Content */}
          <div class="flex-1 min-w-0">
            <h3 class="text-base text-xl md:text-lg font-semibold text-white transition-colors">
              {highlight.title}
            </h3>
            <p class=" text-sm md:text-sm text-gray-400 leading-relaxed">
              {highlight.subtitle}
            </p>
          </div>
        </div>
      </div>
    ))
  }
</div>

<script>
  const observerOptions = {
    root: null,
    rootMargin: "0px",
    threshold: 0.1,
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.remove("opacity-0", "translate-y-8");
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  document.querySelectorAll(".animate-on-scroll").forEach((item) => {
    observer.observe(item);
  });
</script>
