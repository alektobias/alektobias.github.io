---
import fs from "node:fs/promises";
import path from "node:path";
import { Heart, Snowflake, Puzzle, Castle } from "lucide-react";
import { SectionTitle } from "../ui/SectionTitle";
import { loadUiData } from "../../utils/loadData";

interface Props {
  lang?: string;
}

const { lang = "en" } = Astro.props;
const ui = await loadUiData(lang);

// Load Storytelling Data
const storytellingPath = path.join(
  process.cwd(),
  `docs/data/${lang}/storytelling.json`,
);
let stories: any[] = [];

try {
  const content = await fs.readFile(storytellingPath, "utf-8");
  stories = JSON.parse(content);
} catch (error) {
  console.error(`Error loading storytelling for lang: ${lang}`, error);
}

const iconMap: Record<string, any> = {
  Heart,
  Snowflake,
  Puzzle,
  Castle,
};
---

<section
  id="about"
  class="py-24 text-white relative overflow-hidden bg-gray-950"
>
  <!-- Stitch Background -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <!-- Grid pattern -->
    <div
      class="absolute inset-0"
      style="background-image: linear-gradient(rgba(107, 70, 193, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(107, 70, 193, 0.03) 1px, transparent 1px); background-size: 60px 60px; mask-image: radial-gradient(ellipse at center, rgba(0,0,0,0.5) 0%, transparent 70%);"
    >
    </div>

    <!-- Corner glows -->
    <div
      class="absolute top-[10%] left-[5%] w-[200px] h-[200px] rounded-full opacity-30 blur-[80px]"
      style="background: radial-gradient(circle, #8b5cf6 0%, transparent 70%);"
    >
    </div>
    <div
      class="absolute top-[15%] right-[10%] w-[150px] h-[150px] rounded-full opacity-30 blur-[80px]"
      style="background: radial-gradient(circle, #a855f7 0%, transparent 70%);"
    >
    </div>
    <div
      class="absolute bottom-[20%] left-[10%] w-[180px] h-[180px] rounded-full opacity-30 blur-[80px]"
      style="background: radial-gradient(circle, #7c3aed 0%, transparent 70%);"
    >
    </div>
    <div
      class="absolute bottom-[10%] right-[5%] w-[250px] h-[250px] rounded-full opacity-30 blur-[80px]"
      style="background: radial-gradient(circle, #6366f1 0%, transparent 70%);"
    >
    </div>

    <div
      class="absolute top-0 bottom-0 left-[20%] w-px"
      style="background: linear-gradient(180deg, transparent 0%, rgba(139, 92, 246, 0.1) 20%, rgba(139, 92, 246, 0.2) 50%, rgba(139, 92, 246, 0.1) 80%, transparent 100%);"
    >
    </div>
    <div
      class="absolute top-0 bottom-0 right-[20%] w-px"
      style="background: linear-gradient(180deg, transparent 0%, rgba(139, 92, 246, 0.1) 20%, rgba(139, 92, 246, 0.2) 50%, rgba(139, 92, 246, 0.1) 80%, transparent 100%);"
    >
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
    <!-- Elegant Header -->
    <SectionTitle
      title={ui?.journey?.title || "The Story"}
      subtitle={ui?.journey?.subtitle || "Behind the Code"}
    />

    <!-- Bento Grid -->
    <div class="grid grid-cols-1 md:grid-cols-12 gap-8">
      {
        stories.map((item, index) => {
          const IconComponent = iconMap[item.icon] || Puzzle;

          // Asymmetrical grid logic:
          // Row 1: Wide (7) - Narrow (5)
          // Row 2: Narrow (5) - Wide (7)
          const colSpanClass =
            index === 0
              ? "md:col-span-7"
              : index === 1
                ? "md:col-span-5"
                : index === 2
                  ? "md:col-span-5"
                  : "md:col-span-7";

          return (
            <article
              class={`group bg-purple-950/20 border border-purple-500/10 rounded-2xl p-8 transition-all duration-700 ease-out relative overflow-hidden hover:border-purple-500/30 hover:-translate-y-1 ${colSpanClass} ${
                index < 2 ? "md:min-h-[320px]" : "md:min-h-[280px]"
              } opacity-0 translate-y-8 animate-on-scroll`}
              style={`transition-delay: ${index * 150}ms`}
            >
              {/* Hover glow effect */}
              <div class="absolute inset-0 bg-linear-to-br from-purple-500/5 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none" />

              {/* Background Blended Icon */}
              <div class="absolute right-[-20px] bottom-[-20px] opacity-[0.03] group-hover:opacity-[0.08] transition-all duration-500 transform group-hover:scale-110  pointer-events-none">
                <IconComponent
                  size={240}
                  className="text-purple-300"
                  strokeWidth={0.8}
                />
              </div>

              <div class="relative z-10 h-full flex flex-col">
                <div class="mb-6">
                  <h3 class="text-2xl font-medium text-white/90 tracking-tight group-hover:text-purple-200 transition-colors duration-300">
                    {item.title}
                  </h3>
                </div>
                <p class="text-sm md:text-md lg:text-lg leading-relaxed text-white/60 font-light group-hover:text-white/70 transition-colors duration-300">
                  {item.content}
                </p>
              </div>
            </article>
          );
        })
      }
    </div>
  </div>
</section>

<script>
  const observerOptions = {
    root: null,
    rootMargin: "0px",
    threshold: 0.1,
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.remove("opacity-0", "translate-y-8");
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  document.querySelectorAll(".animate-on-scroll").forEach((item) => {
    observer.observe(item);
  });
</script>
